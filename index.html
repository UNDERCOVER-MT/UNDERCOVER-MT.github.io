<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <title>UnderCover-MT</title>
    <link rel="icon" href="/src/assets/logo.jpeg" type="image/png" sizes="32x32">

    <!-- Leaflet links -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="./src/css/styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

    <script src="src/js/L.LabelTextCollision.js"></script>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- upload file -->
    <script type="application/javascript"
        src="https://unpkg.com/leaflet-better-filelayer@0.1.0/dist/leaflet.betterfilelayer.min.js"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-better-filelayer@0.1.0/dist/leaflet.betterfilelayer.css"
        crossorigin="anonymous" referrerpolicy="no-referrer">


    <!-- notifications -->
    <link rel="stylesheet" href="src/css/leaflet-notifications.min.css">
    <script src="src/js/leaflet-notifications.min.js"></script>


    <!-- full screen -->
    <link rel="stylesheet" href="src/css/Control.FullScreen.css" />
    <script src="src/js/Control.FullScreen.js"></script>


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- locate user -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js"
        charset="utf-8"></script>

    <script src="src/js/leaflet-hash.js"></script>

    <!-- add geocoder/ search box -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <!-- hide areas outside germany -->
    <script src="src/js/leaflet.snogylop.js"></script>

    <!-- Measure toolbox -->
    <!-- <link rel="stylesheet" href="scss/leaflet-measure.scss">
    <script src="src/leaflet-measure.js"></script> -->
    <link rel="stylesheet" href="src/css/Leaflet.LinearMeasurement.css" />

    <!-- Leaflet Panel Layers CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-panel-layers/dist/leaflet-panel-layers.min.css">
    <script src="https://unpkg.com/leaflet-panel-layers/dist/leaflet-panel-layers.min.js"></script>

    <!-- Leaflet Routing Machine CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>



    <!-- data classification plugin: -->
    <script src="src/js/leaflet-dataclassification.js"></script>
    <link rel="stylesheet" href="src/css/leaflet-dataclassification.css" />
    <!-- dependencies: -->
    <script src="src/js/simple-statistics.min.js"></script>
    <script src="src/js/chroma.min.js"></script>

    <!-- Easy button -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

    <!-- icon base maps -->
    <script type="text/javascript" src="./src/js/providers.js"></script>
    <script type="text/javascript" src="./src/js/iconLayers.js"></script>
    <link rel="stylesheet" href="./src/css/iconLayers.css">

    <!-- Load data -->
    <script src="data/mt_a.js" type="text/javascript"></script>
    <script src="data/mt_b.js" type="text/javascript"></script>
    <script src="data/mt_c.js" type="text/javascript"></script>
    <script src="data/major_powerline.js" type="text/javascript"></script>
    <script src="data/minor_powerline.js" type="text/javascript"></script>
    <script src="data/geology.js" type="text/javascript"></script>
    <script src="data/faults.js" type="text/javascript"></script>
    <script src="data/notes.js" type="text/javascript"></script>



</head>


<body>
    <script type="text/javascript" src="src/js/Leaflet.LinearMeasurement.js"></script>


    <script src="data/finland.js" type="text/javascript"></script>

    <main id="bodyWrapper">
        <!-- Header -->
        <nav class="navbar navbar-light justify-content-center py-1" style="background-color: #eff7fa;">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <img src="./src/assets/logo.jpeg" height="36" class="me-2" alt="Logo">
                <span class="navbar-text">MT database for UnderCover</span>
            </a>
        </nav>

        <ul class="nav nav-tabs justify-content-center" id="mainTabs" role="tablist" style="background-color: #f1f1f1;">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="maps-tab" data-bs-toggle="tab" data-bs-target="#mapPane"
                    type="button" role="tab" aria-controls="mapPane" aria-selected="true">Maps</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboardPane"
                    type="button" role="tab" aria-controls="dashboardPane" aria-selected="false">Field Work
                    Dashboard</button>
            </li>
        </ul>
        <!-- Tab Contents -->
        <div class="tab-content" id="mainTabContent" style="height: calc(100vh - 120px); overflow: auto;">

            <!-- Map View -->
            <div class="tab-pane fade show active" id="mapPane" role="tabpanel" aria-labelledby="maps-tab">
                <div id="mapWrapper" style="height: 91vh">
                    <!-- Add inside <body>, below your map -->

                    <div id="map" style="height: 100%;"></div>

                </div>

            </div> <!-- ✅ CLOSE mapPane here -->

            <!-- Dashboard -->
            <div class="tab-pane fade" id="dashboardPane" role="tabpanel" aria-labelledby="dashboard-tab"
                style="height: 100%; overflow-y: auto; background-color: #f8f9fa;">
                <div class="container py-3">
                    <!-- dashboard content -->

                    <h4>Field Work Progress</h4>

                    <!-- ECharts Chart -->
                    <div id="echarts-container" style="width: 100%; height: 400px; margin-bottom: 30px;"></div>


                    <!-- Bar Chart: Number of Stations per Day -->
                    <!-- <h5>Stations Deployed per Day</h5> -->
                    <div id="stationBarChart" style="width: 60vh; height: 400px; margin-bottom: 30px;"></div>

                    <h5>Update Log</h5>
                    <table class="table table-striped table-bordered align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Site</th>
                                <th>Date</th>
                                <th>Comment</th>
                                <th>Team</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Blue row: uc058b -->
                            <tr>
                                <td>uc058b</td>
                                <td>
                                    <script>document.write(new Date().toISOString().split('T')[0])</script>
                                </td>
                                <td></td>
                                <td>
                                    <img src="https://randomuser.me/api/portraits/lego/4.jpg"
                                        class="rounded-circle me-1" height="40" alt="tech1">
                                    <img src="https://randomuser.me/api/portraits/lego/2.jpg" class="rounded-circle"
                                        height="40" alt="tech2">
                                </td>
                            </tr>
                            <!-- Blue row: uc067b -->
                            <tr>
                                <td>uc066b</td>
                                <td>
                                    <script>document.write(new Date().toISOString().split('T')[0])</script>
                                </td>
                                <td> </td>
                                <td>
                                    <img src="https://randomuser.me/api/portraits/lego/4.jpg"
                                        class="rounded-circle me-1" height="40" alt="tech1">
                                    <img src="https://randomuser.me/api/portraits/lego/2.jpg" class="rounded-circle"
                                        height="40" alt="tech2">
                                </td>
                            </tr>

                            <!-- Blue row: uc067b -->
                            <tr>
                                <td>uc067b</td>
                                <td>
                                    <script>document.write(new Date().toISOString().split('T')[0])</script>
                                </td>
                                <td>drive around trailer in road on south side</td>
                                <td>
                                    <img src="https://randomuser.me/api/portraits/lego/4.jpg"
                                        class="rounded-circle me-1" height="40" alt="tech1">
                                    <img src="https://randomuser.me/api/portraits/lego/2.jpg" class="rounded-circle"
                                        height="40" alt="tech2">
                                </td>
                            </tr>

                            <!-- Gray row: uc084b -->
                            <tr>
                                <td>uc084b</td>
                                <td>
                                    <script>document.write(new Date().toISOString().split('T')[0])</script>
                                </td>
                                <td>High contact resistances</td>
                                <td>
                                    <img src="https://randomuser.me/api/portraits/lego/1.jpg"
                                        class="rounded-circle me-1" height="40" alt="tech1">
                                    <img src="https://randomuser.me/api/portraits/lego/3.jpg" class="rounded-circle"
                                        height="40" alt="tech2">
                                </td>
                            </tr>

                            <!-- Gray row: uc095c -->
                            <tr>
                                <td>uc096c</td>
                                <td>
                                    <script>document.write(new Date().toISOString().split('T')[0])</script>
                                </td>
                                <td>CAREFUL! By is reversed!</td>
                                <td>
                                    <img src="https://randomuser.me/api/portraits/lego/1.jpg"
                                        class="rounded-circle me-1" height="40" alt="tech1">
                                    <img src="https://randomuser.me/api/portraits/lego/3.jpg" class="rounded-circle"
                                        height="40" alt="tech2">
                                </td>
                            </tr>
                        </tbody>
                    </table>


                    <!-- Map Thumbnails -->
                    <h5>Site Snapshots</h5>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="card">
                                <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Site A Map">
                                <div class="card-body">
                                    <p class="card-text">Map overview for Site A.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card">
                                <img src="https://via.placeholder.com/300x200" class="card-img-top" alt="Site B Map">
                                <div class="card-body">
                                    <p class="card-text">Map overview for Site B.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- ✅ End dashboardPane -->

        </div> <!-- ✅ End tab-content -->

    </main>

    <!-- Scripts -->
    <script src="./src/js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script>
        let chartInitialized = false;

        document.getElementById('dashboard-tab').addEventListener('shown.bs.tab', function () {
            if (!chartInitialized) {
                const chartDom = document.getElementById('echarts-container');
                if (chartDom) {
                    const myChart = echarts.init(chartDom);
                    const completed = 5;  // Change as needed
                    const total = 230;
                    const remaining = total - completed;

                    const option = {
                        title: {
                            text: 'Field Work Completion',
                            left: 'center'
                        },
                        tooltip: {
                            trigger: 'item'
                        },
                        legend: {
                            orient: 'horizontal',
                            bottom: '0%',
                            left: 'center'
                        },
                        series: [
                            {
                                name: 'Sites',
                                type: 'pie',
                                radius: '60%',
                                data: [
                                    { value: completed, name: 'Completed' },
                                    { value: remaining, name: 'Remaining' }
                                ],
                                emphasis: {
                                    itemStyle: {
                                        shadowBlur: 10,
                                        shadowOffsetX: 0,
                                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                                    }
                                },
                                label: {
                                    formatter: '{b}: {c} ({d}%)'
                                }
                            }
                        ]
                    };
                    myChart.setOption(option);
                    chartInitialized = true;
                }
            }
        });

        // Bar Chart - Stations Per Day (example data)
        const stationDates = [
            '2025-05-20', '2025-05-20', '2025-05-20',
            '2025-05-20', '2025-05-20',

        ];
        // Count frequency per date
        const dateCount = {};
        stationDates.forEach(date => {
            dateCount[date] = (dateCount[date] || 0) + 1;
        });
        const dateLabels = Object.keys(dateCount).sort();
        const dateValues = dateLabels.map(date => dateCount[date]);

        const stationBarDom = document.getElementById('stationBarChart');
        const stationBar = echarts.init(stationBarDom);
        const barOption = {
            title: {
                text: 'Stations Logged per Day',
                left: 'center'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'shadow' }
            },
            grid: {
                left: '10%',
                right: '5%',
                bottom: '15%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                data: dateLabels,
                name: 'Date',
                axisLabel: {
                    rotate: 30, // Rotate labels if dates are long
                    fontSize: 12
                }
            },
            yAxis: {
                type: 'value',
                name: 'Stations',
                axisLabel: {
                    fontSize: 12
                }
            },
            series: [{
                data: dateValues,
                type: 'bar',
                barWidth: '50%',
                itemStyle: {
                    color: '#5470C6'
                },
                label: {
                    show: true,
                    position: 'top',
                    fontSize: 12
                }
            }]
        };

        stationBar.setOption(barOption);

    </script>



    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Disclaimer – UNDERCOVER Project</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>
                        This is a <strong>test site</strong> used solely for <strong>field work collaboration</strong>
                        within
                        the
                        <strong>UNDERCOVER project</strong>. It is intended for visualization and sharing of
                        <strong>Magnetotelluric (MT) Metadata</strong> among project partners.
                    </p>

                    <p>
                        While efforts have been made to ensure the accuracy and reliability of the data provided,
                        no guarantee is made regarding its completeness/accuracy.
                    </p>

                    <p>
                        For any questions, clarifications, or inquiries, please contact:
                        <b>h.marzouk@uni-muenster.de</b>
                    </p>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="mailbutton">Contact us</button>
                </div>
            </div>
        </div>
    </div>

</body>

</html>